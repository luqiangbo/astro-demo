pipeline:
  build-dev:
    image: docker
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    commands:
      - docker-compose down
      - docker-compose build
      - docker-compose up -e WEB_ENV=build:dev -e ENV=dev -d
    when:
      event: tag
      branch: '*'
      ref: refs/tags/dev.*
    privileged: true
  build-prod:
    image: docker
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    commands:
      - docker-compose down
      - docker-compose build
      - docker-compose up -e WEB_ENV=build:prod -e ENV=prod -d
    when:
      event: tag
      branch: '*'
      ref: refs/tags/prod.*
    privileged: true
